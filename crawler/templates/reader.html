{% extends 'index.html' %}
{% load static %}

{% block title %}
Reader
{% endblock %}

{% block content %}
<form method="POST">
	{% csrf_token %}
	<input type="hidden" id="id" name="id" value="{{paper.id}}">
<div class="page-inner">
	<div class="row">
		<div class="col-md-4">
			<div class="card">
				<div class="card-header">
						<div class="card-head-row">
							<div class="card-title">Tags</div>
										<div class="card-tools">
											<input class="btn btn-info btn-border btn-round btn-sm mr-2" type="submit" value="Submit">										</div>
						</div></div>
				<div class="card-body">
					<div><b>{% for ta in tags %}<a href="/crawler/tag?tag={{ta.tag.text}}">{{ta.tag.text}}</a>, {%endfor%}</b></div>
					<div class="form-group" id="tags">
					</div>
				</div>

			</div>
			<div class="card">
					<div class="card-header">
						<div class="card-head-row">
							<div class="card-title">{{paper.title}}</div>
										<div class="card-tools">
											<a href="/crawler/reader?id={{paper.id|add:-1}}" class="btn btn-info btn-border btn-round btn-sm mr-2">
												<span class="btn-label">
													<i class="fa fa-pencil"></i>
												</span>
												Previous
											</a>
											<a href="/crawler/reader?id={{paper.id|add:1}}" class="btn btn-info btn-border btn-round btn-sm mr-2">
												<span class="btn-label">
													<i class="fa fa-pencil"></i>
												</span>
												Next
											</a>
											<!--a href="#" class="btn btn-info btn-border btn-round btn-sm">
												<span class="btn-label">
													<i class="fa fa-print"></i>
												</span>
												Print
											</a>-->
										</div>
									</div>
								</div>
				<div class="card-body">
					<div><p><b>Authors: {%for a in paper.authors.all%}{{a.name}} {%endfor%}</b></p></div>
					<div><p><b>Network score: {{ maxNetworkSize }}</b></p></div>
					<div><b>Abstract:</b>{{paper.abstract}}</div>
				</div>
			</div>
			
		</div>
		<div class="col-md-8">
			<div class="card">
				<div class="card-body">
					<div id="example1"></div>		
				</div>
			</div>
			<div class="card">
				<div class="card-body">
					<div id="words"></div>
				</div>
			</div>
		</div>

	</div>
</div>
</form>
{% endblock %}

{% block js %}
	<script src="{% static 'js/plugin/taggle.js/example/js/taggle.min.js' %}"></script>
	<script type="text/javascript">
		jQuery.curCSS = jQuery.css;
		PDFObject.embed("/static/paper{{paper.id}}.pdf", "#example1");
		var tagger = new Taggle('tags', {
			tags: [],
    			duplicateTagClass: 'bounce'
		});
		var container = tagger.getContainer();
		var input = tagger.getInput();

		$(input).autocomplete({
    			source: [{% for v in vocab %}'{{v.text}}',{% endfor %}], // See jQuery UI documentaton for options
   			appendTo: container,
   		 	position: { at: "left bottom", of: container },
    			select: function(event, data) {
        			event.preventDefault();
        			//Add the tag if user clicks
        			if (event.which === 1) {
            				tagger.add(data.item.value);
        			}
    			}
		});
		var data = [{% for word in words %}{"word": "{{ word.word }}", "count": {{ word.count}}},{% endfor %}];
		$(function(){
 		 	var countMax = d3.max(data, function(d){ return d.count} );
  			var sizeScale = d3.scaleLinear().domain([0, countMax]).range([10, 100])
    			d3.layout.cloud().size([750, 300])
        			.words(data.map(function(d) {
                			return {text: d.word, size: sizeScale(d.count)}; 
            				})
        			) 
				.rotate(function() { return (~~(Math.random() * 6) - 3) * 30; })
				.font("Impact")ã€€
				.fontSize(function(d) { return d.size; })
        			.on("end", draw)
        			.start();
    
		   	function draw(words) {
        			d3.select("#words").append("svg")
            			.attr("width", "100%")
           			.attr("height", 300)
				.attr("class", "ui fluid image") // style using semantic ui
        			.attr("viewBox", "0 0 750 300")  // ViewBox : x, y, width, height
            			.append("g")
            			.attr("transform", "translate(375,150)")
      .selectAll("text")
        .data(words)
      .enter().append("text")
        .style("font-size", function(d) { return d.size + "px"; })
        .style("font-family", "Impact")
        .style("fill", function(d, i) { return d3.schemeCategory10[i % 10]; })
        .attr("text-anchor", "middle")
        .attr("transform", function(d) {
          return "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")";
        })
        .text(function(d) { return d.text; });
   			}    
 
		}());  
	</script>
{% endblock %}

{% block css %}
<!--link rel="stylesheet" href="{% static 'js/plugin/tagify/style.css' %}"-->
{% endblock %}
